#!/usr/bin/env bash

this-branch() {
    git rev-parse --abbrev-ref HEAD
}

list-item() {
    echo "$1 (y/n/d) "
    read yn
    case "$yn" in
        y|Y|yes)
            ;;
        n|N|q|Q|no)
            exit 1
            ;;
        d|D)
            git diff origin/master...HEAD
            list-item "$1"
            ;;
        *)
            echo "Invalid response: $yn"
            list-item "$1"
            ;;
    esac
}

show-checklist() {
    list-item 'Is this the simplest/smallest set of changes that can be made?'
    list-item 'Have you thoroughly tested all branches of your code?'
    list-item 'Have you broken your code yet?'

    push_cmd="git push -u origin \"$(this-branch)\""
    list-item "Automatically push ($push_cmd)?"
    eval "$push_cmd"
}

show-checklist
